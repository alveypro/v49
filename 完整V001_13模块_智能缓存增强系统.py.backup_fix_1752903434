#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
å®Œæ•´V001_13æ¨¡å—_æ™ºèƒ½ç¼“å­˜å¢å¼ºç³»ç»Ÿ
================================================================
å®Œæ•´çš„ä¸­å›½è‚¡å¸‚åˆ†æç³»ç»Ÿï¼ŒåŒ…å«æ‰€æœ‰13ä¸ªæ ¸å¿ƒæ¨¡å—:

æ ¸å¿ƒæ¨¡å—åˆ—è¡¨:
1.  ç³»ç»Ÿé¦–é¡µ - ç³»ç»ŸçŠ¶æ€ç›‘æ§ä¸æ¶æ„å±•ç¤º
2.  å¸‚åœºæ€»è§ˆ - å®æ—¶ç›‘æ§5000+åªè‚¡ç¥¨è¡Œæƒ…
3.  æš´æ¶¨ç­–ç•¥ - ä»5000+åªè‚¡ç¥¨ä¸­å‘ç°æš´æ¶¨æœºä¼š
4.  ä»·å€¼æŠ•èµ„ - å…¨å¸‚åœºä»·å€¼è‚¡ç¥¨ç­›é€‰
5.  æŠ€æœ¯åˆ†æ - ä¸“ä¸šæŠ€æœ¯æŒ‡æ ‡åˆ†æ
6.  ç­–ç•¥å›æµ‹ - æŠ•èµ„ç­–ç•¥å›æµ‹ä¸ä¼˜åŒ–
7.  å®æ—¶ç›‘æ§ - å®æ—¶ç›‘æ§è‚¡ç¥¨å¼‚åŠ¨
8.  ä¸ªè‚¡åˆ†æ - å•åªè‚¡ç¥¨æ·±åº¦åˆ†æ
9.  æŠ•èµ„ç»„åˆ - æŠ•èµ„ç»„åˆç®¡ç†ä¸ä¼˜åŒ–
10.  è¶…çº§é€‰è‚¡ - æœºæ„çº§æ™ºèƒ½é€‰è‚¡ç³»ç»Ÿ
11.  æœºæ„æ•°æ® - æœºæ„çº§æ•°æ®ä¸­å¿ƒ
12.  AIé¢„æµ‹ - AIæ™ºèƒ½é¢„æµ‹ç³»ç»Ÿ
13.  ç³»ç»Ÿè®¾ç½® - ç³»ç»Ÿé…ç½®ä¸æ€§èƒ½ç®¡ç†

æŠ€æœ¯ç‰¹æ€§:
æ™ºèƒ½ç¼“å­˜å¢å¼º - æ¯«ç§’çº§å“åº”é€Ÿåº¦
æœºæ„æ•°æ®æ¨¡å—é›†æˆ - ä¸“ä¸šçº§æ•°æ®æº
v068æ°¸ä¹…æ¶æ„ - ç¨³å®šå¯é 
v730é€‰è‚¡å¼•æ“ - ç»ˆæé€‰è‚¡ç­–ç•¥
ä¸­å›½äº¤æ˜“æ—¶é—´æ„ŸçŸ¥ - æ™ºèƒ½ç¼“å­˜ç­–ç•¥

ç‰ˆæœ¬: V001 Complete Enhanced
åˆ›å»ºæ—¶é—´: 2025-07-15 16:30 (ä¸­å›½æ—¶é—´)
"""

import streamlit as st
import pandas as pd
import numpy as np
import time
import json
from datetime import datetime, timedelta
import threading
from typing import Dict, List, Any, Optional
import warnings
import logging
import re

warnings.filterwarnings('ignore')

# é…ç½®æ—¥å¿—
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger('V001_System')

# ç»Ÿä¸€æœºæ„æ•°æ®æ¨¡å—å¯¼å…¥
UNIFIED_DATA_MODULE_AVAILABLE = False
try:
    from ç»Ÿä¸€æœºæ„æ•°æ®æ¨¡å—_UnifiedInstitutionalDataModule import (
        get_data_for_short_term_surge,
        get_data_for_value_mining,
        get_data_for_super_selection,
        get_unified_stock_data,
        get_engine_status,
        clear_data_cache,
        get_institutional_data,
        get_realtime_data,
        get_technical_indicators,
        get_market_overview_data,
        get_ai_predictions
    )
    UNIFIED_DATA_MODULE_AVAILABLE = True
    logger.info("âœ… ç»Ÿä¸€æœºæ„æ•°æ®æ¨¡å—åŠ è½½æˆåŠŸ")
except ImportError as e:
    logger.warning(f"âš ï¸ ç»Ÿä¸€æœºæ„æ•°æ®æ¨¡å—æœªæ‰¾åˆ°: {e}")
    logger.info("ğŸ’¡ ç³»ç»Ÿå°†ä½¿ç”¨æ¼”ç¤ºæ•°æ®æ¨¡å¼")

# æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿå¯¼å…¥
INTELLIGENT_CACHE_AVAILABLE = False
try:
    from ä¸­å›½è‚¡å¸‚æ™ºèƒ½ç¼“å­˜ç®¡ç†å™¨ import ChinaStockIntelligentCacheSystem
    INTELLIGENT_CACHE_AVAILABLE = True
    logger.info("âœ… æ™ºèƒ½ç¼“å­˜ç³»ç»ŸåŠ è½½æˆåŠŸ")
except ImportError as e:
    logger.warning(f"âš ï¸ æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿæœªæ‰¾åˆ°: {e}")
    logger.info("ğŸ’¡ ç³»ç»Ÿå°†ä½¿ç”¨åŸºç¡€ç¼“å­˜æ¨¡å¼")

# Tushareé…ç½®
try:
    import tushare as ts
    # å°è¯•ä»æ–‡ä»¶è¯»å–token
    token_files = ['.tushare_token', 'tushare_token.txt', '.env']
    tushare_token = None
    
    for token_file in token_files:
        try:
            with open(token_file, 'r') as f:
                content = f.read().strip()
                if 'TUSHARE_TOKEN' in content:
                    tushare_token = content.split('=')[1].strip()
                else:
                    tushare_token = content
                break
        except:
            continue
    
    if tushare_token:
        ts.set_token(tushare_token)
        pro = ts.pro_api()
        TUSHARE_AVAILABLE = True
        logger.info("âœ… Tushare Pro APIé…ç½®æˆåŠŸ")
    else:
        TUSHARE_AVAILABLE = False
        logger.warning("âš ï¸ Tushare tokenæœªæ‰¾åˆ°")
except ImportError:
    TUSHARE_AVAILABLE = False
    logger.warning("âš ï¸ Tushareæœªå®‰è£…")

class V001CompleteSystem:
    """
    V001å®Œæ•´13æ¨¡å—æ™ºèƒ½ç¼“å­˜å¢å¼ºç³»ç»Ÿ
    """
    
    def __init__(self):
        self.system_name = "å®Œæ•´V001_13æ¨¡å—_æ™ºèƒ½ç¼“å­˜å¢å¼ºç³»ç»Ÿ"
        self.version = "V001 Complete Enhanced"
        self.base_architecture = "v068æ°¸ä¹…æ¶æ„ + v730é€‰è‚¡å¼•æ“"
        self.full_stock_count = 5000
        
        # 13ä¸ªæ ¸å¿ƒæ¨¡å—å®šä¹‰
        self.modules = {
            "1.  ç³»ç»Ÿé¦–é¡µ": self.render_home,
            "2.  å¸‚åœºæ€»è§ˆ": self.render_market_overview,
            "3.  æš´æ¶¨ç­–ç•¥": self.render_surge_strategy,
            "4.  ä»·å€¼æŠ•èµ„": self.render_value_investment,
            "5.  æŠ€æœ¯åˆ†æ": self.render_technical_analysis,
            "6.  ç­–ç•¥å›æµ‹": self.render_strategy_backtest,
            "7.  å®æ—¶ç›‘æ§": self.render_realtime_monitor,
            "8.  ä¸ªè‚¡åˆ†æ": self.render_individual_analysis,
            "9.  æŠ•èµ„ç»„åˆ": self.render_portfolio_management,
            "10.  è¶…çº§é€‰è‚¡": self.render_super_stock_screening,
            "11.  æœºæ„æ•°æ®": self.render_institutional_data,
            "12.  AIé¢„æµ‹": self.render_ai_prediction,
            "13.  ç³»ç»Ÿè®¾ç½®": self.render_system_settings
        }
        
        # ç³»ç»Ÿæ¶æ„ä¿¡æ¯
        self.architecture = {
            "æ™ºèƒ½ç¼“å­˜å±‚": {"å“åº”æ—¶é—´": "< 1ms", "å­˜å‚¨": "4å±‚ç¼“å­˜", "å®¹é‡": "1GB"},
            "æ•°æ®ç»Ÿä¸€å±‚": {"å“åº”æ—¶é—´": "< 100ms", "å­˜å‚¨": "æœºæ„æ•°æ®æ¨¡å—", "å®¹é‡": "5000+è‚¡ç¥¨"},
            "ç•Œé¢å±•ç¤ºå±‚": {"å“åº”æ—¶é—´": "< 50ms", "å­˜å‚¨": "å†…å­˜æ¸²æŸ“", "å®¹é‡": "å®æ—¶"},
            "åˆ†æç®—æ³•å±‚": {"å“åº”æ—¶é—´": "< 200ms", "å­˜å‚¨": "æœ¬åœ°è®¡ç®—", "å®¹é‡": "å¤šç­–ç•¥"},
            "äº¤äº’æ§åˆ¶å±‚": {"å“åº”æ—¶é—´": "< 10ms", "å­˜å‚¨": "çŠ¶æ€ç®¡ç†", "å®¹é‡": "å…¨åŠŸèƒ½"}
        }
        
        # åˆå§‹åŒ–æ™ºèƒ½ç¼“å­˜
        if INTELLIGENT_CACHE_AVAILABLE:
            self.cache_system = ChinaStockIntelligentCacheSystem(max_memory_mb=512)
            self.cache_enabled = True
        else:
            self.cache_system = None
            self.cache_enabled = False
    
    def get_demo_stock_data(self, count=20):
        """è·å–æ¼”ç¤ºè‚¡ç¥¨æ•°æ®"""
        demo_stocks = [
            {'ä»£ç ': '000001', 'åç§°': 'å¹³å®‰é“¶è¡Œ', 'ä»·æ ¼': 12.45, 'æ¶¨è·Œå¹…': 2.1, 'æˆäº¤é‡': 1234567},
            {'ä»£ç ': '000002', 'åç§°': 'ä¸‡ç§‘A', 'ä»·æ ¼': 18.76, 'æ¶¨è·Œå¹…': -1.2, 'æˆäº¤é‡': 987654},
            {'ä»£ç ': '000858', 'åç§°': 'äº”ç²®æ¶²', 'ä»·æ ¼': 168.90, 'æ¶¨è·Œå¹…': 3.5, 'æˆäº¤é‡': 2345678},
            {'ä»£ç ': '600036', 'åç§°': 'æ‹›å•†é“¶è¡Œ', 'ä»·æ ¼': 42.30, 'æ¶¨è·Œå¹…': 1.8, 'æˆäº¤é‡': 3456789},
            {'ä»£ç ': '600519', 'åç§°': 'è´µå·èŒ…å°', 'ä»·æ ¼': 1680.50, 'æ¶¨è·Œå¹…': 2.3, 'æˆäº¤é‡': 456789},
        ]
        
        # æ‰©å±•åˆ°æŒ‡å®šæ•°é‡
        extended_stocks = []
        for i in range(count):
            stock = demo_stocks[i % len(demo_stocks)].copy()
            stock['ä»£ç '] = f"{int(stock['ä»£ç ']) + i:06d}"
            stock['åç§°'] = f"{stock['åç§°']}{i+1}"
            stock['ä»·æ ¼'] = round(stock['ä»·æ ¼'] * (0.8 + 0.4 * np.random.random()), 2)
            stock['æ¶¨è·Œå¹…'] = round(-10 + 20 * np.random.random(), 2)
            stock['æˆäº¤é‡'] = int(stock['æˆäº¤é‡'] * (0.5 + np.random.random()))
            extended_stocks.append(stock)
        
        return pd.DataFrame(extended_stocks)
    
    def render_home(self):
        """æ¸²æŸ“ç³»ç»Ÿé¦–é¡µ"""
        st.header("ğŸ  V001ç³»ç»Ÿé¦–é¡µ")
        
        # ç³»ç»ŸçŠ¶æ€æŒ‡æ ‡
        col1, col2, col3, col4 = st.columns(4)
        with col1:
            st.metric("ç³»ç»ŸçŠ¶æ€", "âœ… è¿è¡Œä¸­", "æ™ºèƒ½ç¼“å­˜å¢å¼º")
        with col2:
            cache_status = "å·²å¯ç”¨" if self.cache_enabled else "ç¦»çº¿"
            st.metric("æ™ºèƒ½ç¼“å­˜", cache_status, "4å±‚æ¶æ„")
        with col3:
            data_status = "å·²è¿æ¥" if UNIFIED_DATA_MODULE_AVAILABLE else "æ¼”ç¤ºæ¨¡å¼"
            st.metric("æ•°æ®æº", data_status, "æœºæ„çº§")
        with col4:
            st.metric("è‚¡ç¥¨è¦†ç›–", f"{self.full_stock_count}+", "å…¨å¸‚åœº")
        
        # ç³»ç»Ÿæ¶æ„å±•ç¤º
        st.subheader("ğŸ—ï¸ ç³»ç»Ÿæ¶æ„")
        for layer, config in self.architecture.items():
            with st.expander(f"ğŸ” {layer}"):
                col1, col2, col3 = st.columns(3)
                with col1:
                    st.write(f"**å“åº”æ—¶é—´**: {config['å“åº”æ—¶é—´']}")
                with col2:
                    st.write(f"**å­˜å‚¨æ–¹å¼**: {config['å­˜å‚¨']}")
                with col3:
                    st.write(f"**å­˜å‚¨å®¹é‡**: {config['å®¹é‡']}")
        
        # 13ä¸ªæ¨¡å—æ¦‚è§ˆ
        st.subheader("ğŸ“‹ 13ä¸ªæ ¸å¿ƒæ¨¡å—")
        module_info = [
            ("ğŸ  ç³»ç»Ÿé¦–é¡µ", "ç³»ç»ŸçŠ¶æ€ç›‘æ§ä¸æ¶æ„å±•ç¤º"),
            ("ğŸ“Š å¸‚åœºæ€»è§ˆ", "å®æ—¶ç›‘æ§5000+åªè‚¡ç¥¨è¡Œæƒ…"),
            ("ğŸš€ æš´æ¶¨ç­–ç•¥", "ä»5000+åªè‚¡ç¥¨ä¸­å‘ç°æš´æ¶¨æœºä¼š"),
            ("ğŸ’ ä»·å€¼æŠ•èµ„", "å…¨å¸‚åœºä»·å€¼è‚¡ç¥¨ç­›é€‰"),
            ("ğŸ“ˆ æŠ€æœ¯åˆ†æ", "ä¸“ä¸šæŠ€æœ¯æŒ‡æ ‡åˆ†æ"),
            ("ğŸ¯ ç­–ç•¥å›æµ‹", "æŠ•èµ„ç­–ç•¥å›æµ‹ä¸ä¼˜åŒ–"),
            ("ğŸ“± å®æ—¶ç›‘æ§", "å®æ—¶ç›‘æ§è‚¡ç¥¨å¼‚åŠ¨"),
            ("ğŸ” ä¸ªè‚¡åˆ†æ", "å•åªè‚¡ç¥¨æ·±åº¦åˆ†æ"),
            ("ğŸ’¼ æŠ•èµ„ç»„åˆ", "æŠ•èµ„ç»„åˆç®¡ç†ä¸ä¼˜åŒ–"),
            ("ğŸš€ è¶…çº§é€‰è‚¡", "æœºæ„çº§æ™ºèƒ½é€‰è‚¡ç³»ç»Ÿ"),
            ("ğŸ¢ æœºæ„æ•°æ®", "æœºæ„çº§æ•°æ®ä¸­å¿ƒ"),
            ("ğŸ§  AIé¢„æµ‹", "AIæ™ºèƒ½é¢„æµ‹ç³»ç»Ÿ"),
            ("âš™ï¸ ç³»ç»Ÿè®¾ç½®", "ç³»ç»Ÿé…ç½®ä¸æ€§èƒ½ç®¡ç†")
        ]
        
        for i in range(0, len(module_info), 2):
            col1, col2 = st.columns(2)
            with col1:
                if i < len(module_info):
                    name, desc = module_info[i]
                    st.info(f"**{name}**\n{desc}")
            with col2:
                if i + 1 < len(module_info):
                    name, desc = module_info[i + 1]
                    st.info(f"**{name}**\n{desc}")
    
    def render_market_overview(self):
        """æ¸²æŸ“å¸‚åœºæ€»è§ˆ"""
        st.header("ğŸ“Š å¸‚åœºæ€»è§ˆ")
        
        # è·å–æ•°æ®
        if UNIFIED_DATA_MODULE_AVAILABLE:
            try:
                data = get_market_overview_data()
                st.success("âœ… ä½¿ç”¨æœºæ„æ•°æ®æ¨¡å—")
            except:
                data = self.get_demo_stock_data(50)
                st.warning("âš ï¸ æœºæ„æ•°æ®æ¨¡å—å¼‚å¸¸ï¼Œä½¿ç”¨æ¼”ç¤ºæ•°æ®")
        else:
            data = self.get_demo_stock_data(50)
            st.info("ğŸ’¡ ä½¿ç”¨æ¼”ç¤ºæ•°æ®æ¨¡å¼")
        
        # å¸‚åœºæ¦‚å†µ
        st.subheader("ğŸ“ˆ å¸‚åœºæ¦‚å†µ")
        col1, col2, col3, col4 = st.columns(4)
        with col1:
            st.metric("ä¸Šæ¶¨è‚¡ç¥¨", len(data[data['æ¶¨è·Œå¹…'] > 0]), f"{len(data[data['æ¶¨è·Œå¹…'] > 0])/len(data)*100:.1f}%")
        with col2:
            st.metric("ä¸‹è·Œè‚¡ç¥¨", len(data[data['æ¶¨è·Œå¹…'] < 0]), f"{len(data[data['æ¶¨è·Œå¹…'] < 0])/len(data)*100:.1f}%")
        with col3:
            st.metric("å¹³å‡æ¶¨å¹…", f"{data['æ¶¨è·Œå¹…'].mean():.2f}%")
        with col4:
            st.metric("æ€»æˆäº¤é‡", f"{data['æˆäº¤é‡'].sum()/100000000:.1f}äº¿")
        
        # è‚¡ç¥¨åˆ—è¡¨
        st.subheader("ğŸ“‹ è‚¡ç¥¨åˆ—è¡¨")
        st.dataframe(data, use_container_width=True)
    
    def render_surge_strategy(self):
        """æ¸²æŸ“æš´æ¶¨ç­–ç•¥"""
        st.header("ğŸš€ æš´æ¶¨ç­–ç•¥")
        
        # è·å–æ•°æ®
        if UNIFIED_DATA_MODULE_AVAILABLE:
            try:
                data = get_data_for_short_term_surge()
                st.success("âœ… ä½¿ç”¨æœºæ„æ•°æ®æ¨¡å—")
            except:
                data = self.get_demo_stock_data(20)
                st.warning("âš ï¸ æœºæ„æ•°æ®æ¨¡å—å¼‚å¸¸ï¼Œä½¿ç”¨æ¼”ç¤ºæ•°æ®")
        else:
            data = self.get_demo_stock_data(20)
            st.info("ğŸ’¡ ä½¿ç”¨æ¼”ç¤ºæ•°æ®æ¨¡å¼")
        
        # æš´æ¶¨ç­›é€‰æ¡ä»¶
        st.subheader("ğŸ¯ ç­›é€‰æ¡ä»¶")
        col1, col2, col3 = st.columns(3)
        with col1:
            min_change = st.slider("æœ€å°æ¶¨å¹…(%)", 0.0, 10.0, 3.0)
        with col2:
            min_volume = st.slider("æœ€å°æˆäº¤é‡(ä¸‡æ‰‹)", 0, 1000, 100)
        with col3:
            max_price = st.slider("æœ€å¤§ä»·æ ¼(å…ƒ)", 0, 100, 50)
        
        # åº”ç”¨ç­›é€‰
        filtered_data = data[
            (data['æ¶¨è·Œå¹…'] >= min_change) & 
            (data['æˆäº¤é‡'] >= min_volume * 10000) & 
            (data['ä»·æ ¼'] <= max_price)
        ]
        
        st.subheader(f"ğŸ¯ ç­›é€‰ç»“æœ ({len(filtered_data)}åª)")
        if len(filtered_data) > 0:
            st.dataframe(filtered_data.sort_values('æ¶¨è·Œå¹…', ascending=False), use_container_width=True)
        else:
            st.warning("æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨")
    
    def render_value_investment(self):
        """æ¸²æŸ“ä»·å€¼æŠ•èµ„"""
        st.header("ğŸ’ ä»·å€¼æŠ•èµ„")
        
        # è·å–æ•°æ®
        if UNIFIED_DATA_MODULE_AVAILABLE:
            try:
                data = get_data_for_value_mining()
                st.success("âœ… ä½¿ç”¨æœºæ„æ•°æ®æ¨¡å—")
            except:
                data = self.get_demo_stock_data(30)
                st.warning("âš ï¸ æœºæ„æ•°æ®æ¨¡å—å¼‚å¸¸ï¼Œä½¿ç”¨æ¼”ç¤ºæ•°æ®")
        else:
            data = self.get_demo_stock_data(30)
            st.info("ğŸ’¡ ä½¿ç”¨æ¼”ç¤ºæ•°æ®æ¨¡å¼")
        
        # æ·»åŠ ä»·å€¼æŒ‡æ ‡
        data['PE'] = np.random.uniform(5, 50, len(data))
        data['PB'] = np.random.uniform(0.5, 5, len(data))
        data['ROE'] = np.random.uniform(5, 25, len(data))
        
        # ä»·å€¼ç­›é€‰æ¡ä»¶
        st.subheader("ğŸ“Š ä»·å€¼ç­›é€‰")
        col1, col2, col3 = st.columns(3)
        with col1:
            max_pe = st.slider("æœ€å¤§PE", 0, 50, 20)
        with col2:
            max_pb = st.slider("æœ€å¤§PB", 0.0, 5.0, 2.0)
        with col3:
            min_roe = st.slider("æœ€å°ROE(%)", 0, 30, 10)
        
        # åº”ç”¨ç­›é€‰
        value_stocks = data[
            (data['PE'] <= max_pe) & 
            (data['PB'] <= max_pb) & 
            (data['ROE'] >= min_roe)
        ]
        
        st.subheader(f"ğŸ’ ä»·å€¼è‚¡ç¥¨ ({len(value_stocks)}åª)")
        if len(value_stocks) > 0:
            display_data = value_stocks[['ä»£ç ', 'åç§°', 'ä»·æ ¼', 'æ¶¨è·Œå¹…', 'PE', 'PB', 'ROE']]
            st.dataframe(display_data.round(2), use_container_width=True)
        else:
            st.warning("æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ä»·å€¼è‚¡ç¥¨")
    
    def render_technical_analysis(self):
        """æ¸²æŸ“æŠ€æœ¯åˆ†æ"""
        st.header("ğŸ“ˆ æŠ€æœ¯åˆ†æ")
        
        # è‚¡ç¥¨é€‰æ‹©
        stock_code = st.selectbox("é€‰æ‹©è‚¡ç¥¨", ['000001', '000002', '000858', '600036', '600519'])
        
        # ç”ŸæˆæŠ€æœ¯æŒ‡æ ‡æ•°æ®
        dates = pd.date_range(start='2024-01-01', end='2024-12-31', freq='D')
        prices = 100 + np.cumsum(np.random.randn(len(dates)) * 0.5)
        
        tech_data = pd.DataFrame({
            'æ—¥æœŸ': dates,
            'æ”¶ç›˜ä»·': prices,
            'MA5': pd.Series(prices).rolling(5).mean(),
            'MA20': pd.Series(prices).rolling(20).mean(),
            'RSI': np.random.uniform(20, 80, len(dates))
        })
        
        # æŠ€æœ¯æŒ‡æ ‡å›¾è¡¨
        st.subheader("ğŸ“Š ä»·æ ¼èµ°åŠ¿")
        st.line_chart(tech_data.set_index('æ—¥æœŸ')[['æ”¶ç›˜ä»·', 'MA5', 'MA20']])
        
        st.subheader("ğŸ“ˆ RSIæŒ‡æ ‡")
        st.line_chart(tech_data.set_index('æ—¥æœŸ')['RSI'])
        
        # æŠ€æœ¯åˆ†æç»“è®º
        st.subheader("ğŸ“‹ åˆ†æç»“è®º")
        current_price = prices[-1]
        ma5 = tech_data['MA5'].iloc[-1]
        ma20 = tech_data['MA20'].iloc[-1]
        rsi = tech_data['RSI'].iloc[-1]
        
        if current_price > ma5 > ma20:
            st.success("ğŸŸ¢ å¤šå¤´è¶‹åŠ¿ï¼Œå»ºè®®æŒæœ‰æˆ–ä¹°å…¥")
        elif current_price < ma5 < ma20:
            st.error("ğŸ”´ ç©ºå¤´è¶‹åŠ¿ï¼Œå»ºè®®è§‚æœ›æˆ–å‡ä»“")
        else:
            st.warning("ğŸŸ¡ éœ‡è¡è¶‹åŠ¿ï¼Œå»ºè®®è°¨æ…æ“ä½œ")
        
        if rsi > 70:
            st.warning("âš ï¸ RSIè¶…ä¹°ï¼Œæ³¨æ„å›è°ƒé£é™©")
        elif rsi < 30:
            st.info("ğŸ’¡ RSIè¶…å–ï¼Œå¯èƒ½å­˜åœ¨åå¼¹æœºä¼š")
    
    def render_strategy_backtest(self):
        """æ¸²æŸ“ç­–ç•¥å›æµ‹"""
        st.header("ğŸ¯ ç­–ç•¥å›æµ‹")
        
        # ç­–ç•¥å‚æ•°
        st.subheader("âš™ï¸ ç­–ç•¥å‚æ•°")
        col1, col2, col3 = st.columns(3)
        with col1:
            strategy_type = st.selectbox("ç­–ç•¥ç±»å‹", ["å‡çº¿ç­–ç•¥", "RSIç­–ç•¥", "MACDç­–ç•¥"])
        with col2:
            start_date = st.date_input("å¼€å§‹æ—¥æœŸ", datetime(2024, 1, 1))
        with col3:
            end_date = st.date_input("ç»“æŸæ—¥æœŸ", datetime(2024, 12, 31))
        
        if st.button("å¼€å§‹å›æµ‹"):
            # æ¨¡æ‹Ÿå›æµ‹ç»“æœ
            dates = pd.date_range(start=start_date, end=end_date, freq='D')
            returns = np.random.randn(len(dates)) * 0.02
            cumulative_returns = (1 + pd.Series(returns)).cumprod()
            
            backtest_data = pd.DataFrame({
                'æ—¥æœŸ': dates,
                'ç´¯è®¡æ”¶ç›Šç‡': cumulative_returns,
                'åŸºå‡†æ”¶ç›Šç‡': (1 + np.random.randn(len(dates)) * 0.015).cumprod()
            })
            
            # å›æµ‹ç»“æœ
            st.subheader("ğŸ“Š å›æµ‹ç»“æœ")
            st.line_chart(backtest_data.set_index('æ—¥æœŸ'))
            
            # ç»©æ•ˆæŒ‡æ ‡
            total_return = (cumulative_returns.iloc[-1] - 1) * 100
            max_drawdown = ((cumulative_returns / cumulative_returns.cummax()) - 1).min() * 100
            sharpe_ratio = returns.mean() / returns.std() * np.sqrt(252)
            
            col1, col2, col3 = st.columns(3)
            with col1:
                st.metric("æ€»æ”¶ç›Šç‡", f"{total_return:.2f}%")
            with col2:
                st.metric("æœ€å¤§å›æ’¤", f"{max_drawdown:.2f}%")
            with col3:
                st.metric("å¤æ™®æ¯”ç‡", f"{sharpe_ratio:.2f}")
    
    def render_realtime_monitor(self):
        """æ¸²æŸ“å®æ—¶ç›‘æ§"""
        st.header("ğŸ“± å®æ—¶ç›‘æ§")
        
        # ç›‘æ§è®¾ç½®
        st.subheader("âš™ï¸ ç›‘æ§è®¾ç½®")
        col1, col2 = st.columns(2)
        with col1:
            alert_change = st.slider("æ¶¨è·Œå¹…é¢„è­¦(%)", 1.0, 10.0, 5.0)
        with col2:
            refresh_interval = st.slider("åˆ·æ–°é—´éš”(ç§’)", 1, 60, 5)
        
        # å®æ—¶æ•°æ®
        if UNIFIED_DATA_MODULE_AVAILABLE:
            try:
                data = get_realtime_data()
                st.success("âœ… ä½¿ç”¨å®æ—¶æ•°æ®")
            except:
                data = self.get_demo_stock_data(20)
                st.warning("âš ï¸ å®æ—¶æ•°æ®å¼‚å¸¸ï¼Œä½¿ç”¨æ¼”ç¤ºæ•°æ®")
        else:
            data = self.get_demo_stock_data(20)
            st.info("ğŸ’¡ ä½¿ç”¨æ¼”ç¤ºæ•°æ®æ¨¡å¼")
        
        # é¢„è­¦è‚¡ç¥¨
        alert_stocks = data[abs(data['æ¶¨è·Œå¹…']) >= alert_change]
        
        if len(alert_stocks) > 0:
            st.subheader("ğŸš¨ é¢„è­¦è‚¡ç¥¨")
            for _, stock in alert_stocks.iterrows():
                if stock['æ¶¨è·Œå¹…'] > 0:
                    st.success(f"ğŸ“ˆ {stock['åç§°']} ({stock['ä»£ç ']}) +{stock['æ¶¨è·Œå¹…']:.2f}%")
                else:
                    st.error(f"ğŸ“‰ {stock['åç§°']} ({stock['ä»£ç ']}) {stock['æ¶¨è·Œå¹…']:.2f}%")
        
        # å®æ—¶æ•°æ®è¡¨
        st.subheader("ğŸ“Š å®æ—¶æ•°æ®")
        st.dataframe(data, use_container_width=True)
        
        # è‡ªåŠ¨åˆ·æ–°
        if st.button("ğŸ”„ æ‰‹åŠ¨åˆ·æ–°"):
            st.rerun()
    
    def render_individual_analysis(self):
        """æ¸²æŸ“ä¸ªè‚¡åˆ†æ"""
        st.header("ğŸ” ä¸ªè‚¡åˆ†æ")
        
        # è‚¡ç¥¨é€‰æ‹©
        stock_code = st.text_input("è¾“å…¥è‚¡ç¥¨ä»£ç ", "000001")
        
        if stock_code:
            # åŸºæœ¬ä¿¡æ¯
            st.subheader("ğŸ“‹ åŸºæœ¬ä¿¡æ¯")
            col1, col2, col3, col4 = st.columns(4)
            with col1:
                st.metric("è‚¡ç¥¨ä»£ç ", stock_code)
            with col2:
                st.metric("è‚¡ç¥¨åç§°", "å¹³å®‰é“¶è¡Œ")
            with col3:
                st.metric("å½“å‰ä»·æ ¼", "12.45å…ƒ")
            with col4:
                st.metric("æ¶¨è·Œå¹…", "+2.1%")
            
            # è´¢åŠ¡æŒ‡æ ‡
            st.subheader("ğŸ’° è´¢åŠ¡æŒ‡æ ‡")
            financial_data = {
                'æŒ‡æ ‡': ['å¸‚ç›ˆç‡(PE)', 'å¸‚å‡€ç‡(PB)', 'å‡€èµ„äº§æ”¶ç›Šç‡(ROE)', 'æ¯›åˆ©ç‡', 'å‡€åˆ©ç‡'],
                'æ•°å€¼': ['12.5', '1.2', '15.8%', '25.3%', '18.7%'],
                'è¡Œä¸šæ’å': ['ä¸­ç­‰', 'ä¼˜ç§€', 'ä¼˜ç§€', 'è‰¯å¥½', 'ä¼˜ç§€']
            }
            st.dataframe(pd.DataFrame(financial_data), use_container_width=True)
            
            # æŠ€æœ¯åˆ†æ
            st.subheader("ğŸ“ˆ æŠ€æœ¯åˆ†æ")
            # ç”Ÿæˆæ¨¡æ‹ŸKçº¿æ•°æ®
            dates = pd.date_range(start='2024-11-01', end='2024-12-31', freq='D')
            prices = 12 + np.cumsum(np.random.randn(len(dates)) * 0.1)
            
            chart_data = pd.DataFrame({
                'æ—¥æœŸ': dates,
                'ä»·æ ¼': prices
            })
            
            st.line_chart(chart_data.set_index('æ—¥æœŸ'))
            
            # åˆ†æç»“è®º
            st.subheader("ğŸ“Š åˆ†æç»“è®º")
            st.info("ğŸ’¡ è¯¥è‚¡ç¥¨åŸºæœ¬é¢è‰¯å¥½ï¼ŒæŠ€æœ¯é¢å‘ˆç°ä¸Šå‡è¶‹åŠ¿ï¼Œå»ºè®®å…³æ³¨")
    
    def render_portfolio_management(self):
        """æ¸²æŸ“æŠ•èµ„ç»„åˆ"""
        st.header("ğŸ’¼ æŠ•èµ„ç»„åˆ")
        
        # ç»„åˆæ¦‚è§ˆ
        st.subheader("ğŸ“Š ç»„åˆæ¦‚è§ˆ")
        col1, col2, col3, col4 = st.columns(4)
        with col1:
            st.metric("æ€»èµ„äº§", "100ä¸‡å…ƒ")
        with col2:
            st.metric("ä»Šæ—¥æ”¶ç›Š", "+2,500å…ƒ", "+0.25%")
        with col3:
            st.metric("æ€»æ”¶ç›Šç‡", "+15.8%")
        with col4:
            st.metric("æŒä»“è‚¡ç¥¨", "8åª")
        
        # æŒä»“æ˜ç»†
        st.subheader("ğŸ“‹ æŒä»“æ˜ç»†")
        portfolio_data = {
            'è‚¡ç¥¨ä»£ç ': ['000001', '000002', '000858', '600036', '600519'],
            'è‚¡ç¥¨åç§°': ['å¹³å®‰é“¶è¡Œ', 'ä¸‡ç§‘A', 'äº”ç²®æ¶²', 'æ‹›å•†é“¶è¡Œ', 'è´µå·èŒ…å°'],
            'æŒä»“æ•°é‡': [1000, 500, 100, 800, 10],
            'æˆæœ¬ä»·': [11.20, 19.50, 155.00, 40.00, 1580.00],
            'ç°ä»·': [12.45, 18.76, 168.90, 42.30, 1680.50],
            'ç›ˆäº': ['+11.2%', '-3.8%', '+9.0%', '+5.8%', '+6.4%'],
            'å¸‚å€¼': [12450, 9380, 16890, 33840, 16805]
        }
        
        portfolio_df = pd.DataFrame(portfolio_data)
        st.dataframe(portfolio_df, use_container_width=True)
        
        # èµ„äº§é…ç½®
        st.subheader("ğŸ¥§ èµ„äº§é…ç½®")
        allocation_data = pd.DataFrame({
            'æ¿å—': ['é“¶è¡Œ', 'åœ°äº§', 'ç™½é…’', 'ç§‘æŠ€', 'åŒ»è¯'],
            'å æ¯”': [35, 15, 25, 20, 5]
        })
        
        st.bar_chart(allocation_data.set_index('æ¿å—'))
    
    def render_super_stock_screening(self):
        """æ¸²æŸ“è¶…çº§é€‰è‚¡"""
        st.header("ğŸš€ è¶…çº§é€‰è‚¡")
        
        # é€‰è‚¡ç­–ç•¥
        st.subheader("ğŸ¯ é€‰è‚¡ç­–ç•¥")
        col1, col2 = st.columns(2)
        with col1:
            strategy = st.selectbox("é€‰æ‹©ç­–ç•¥", ["æˆé•¿è‚¡ç­–ç•¥", "ä»·å€¼è‚¡ç­–ç•¥", "æŠ€æœ¯çªç ´ç­–ç•¥", "èµ„é‡‘æµå…¥ç­–ç•¥"])
        with col2:
            market_cap = st.selectbox("å¸‚å€¼èŒƒå›´", ["å…¨éƒ¨", "å¤§ç›˜è‚¡", "ä¸­ç›˜è‚¡", "å°ç›˜è‚¡"])
        
        # ç­›é€‰æ¡ä»¶
        st.subheader("ğŸ” ç­›é€‰æ¡ä»¶")
        col1, col2, col3, col4 = st.columns(4)
        with col1:
            min_roe = st.slider("æœ€å°ROE(%)", 0, 30, 10)
        with col2:
            max_pe = st.slider("æœ€å¤§PE", 0, 50, 25)
        with col3:
            min_growth = st.slider("æœ€å°å¢é•¿ç‡(%)", 0, 100, 20)
        with col4:
            min_volume = st.slider("æœ€å°æˆäº¤é‡(ä¸‡)", 0, 10000, 1000)
        
        if st.button("ğŸš€ å¼€å§‹é€‰è‚¡"):
            # è·å–æ•°æ®
            if UNIFIED_DATA_MODULE_AVAILABLE:
                try:
                    data = get_data_for_super_selection()
                    st.success("âœ… ä½¿ç”¨æœºæ„æ•°æ®æ¨¡å—")
                except:
                    data = self.get_demo_stock_data(100)
                    st.warning("âš ï¸ æœºæ„æ•°æ®æ¨¡å—å¼‚å¸¸ï¼Œä½¿ç”¨æ¼”ç¤ºæ•°æ®")
            else:
                data = self.get_demo_stock_data(100)
                st.info("ğŸ’¡ ä½¿ç”¨æ¼”ç¤ºæ•°æ®æ¨¡å¼")
            
            # æ·»åŠ ç­›é€‰æŒ‡æ ‡
            data['ROE'] = np.random.uniform(5, 25, len(data))
            data['PE'] = np.random.uniform(5, 50, len(data))
            data['å¢é•¿ç‡'] = np.random.uniform(0, 50, len(data))
            
            # åº”ç”¨ç­›é€‰æ¡ä»¶
            selected_stocks = data[
                (data['ROE'] >= min_roe) &
                (data['PE'] <= max_pe) &
                (data['å¢é•¿ç‡'] >= min_growth) &
                (data['æˆäº¤é‡'] >= min_volume * 10000)
            ]
            
            st.subheader(f"ğŸ¯ é€‰è‚¡ç»“æœ ({len(selected_stocks)}åª)")
            if len(selected_stocks) > 0:
                display_data = selected_stocks[['ä»£ç ', 'åç§°', 'ä»·æ ¼', 'æ¶¨è·Œå¹…', 'ROE', 'PE', 'å¢é•¿ç‡']]
                st.dataframe(display_data.round(2), use_container_width=True)
                
                # æ¨èåº¦è¯„åˆ†
                st.subheader("â­ æ¨èåº¦æ’å")
                selected_stocks['ç»¼åˆè¯„åˆ†'] = (
                    selected_stocks['ROE'] * 0.3 +
                    (50 - selected_stocks['PE']) * 0.3 +
                    selected_stocks['å¢é•¿ç‡'] * 0.4
                )
                top_stocks = selected_stocks.nlargest(5, 'ç»¼åˆè¯„åˆ†')
                
                for i, (_, stock) in enumerate(top_stocks.iterrows()):
                    st.success(f"ğŸ† ç¬¬{i+1}å: {stock['åç§°']} ({stock['ä»£ç ']}) - è¯„åˆ†: {stock['ç»¼åˆè¯„åˆ†']:.1f}")
            else:
                st.warning("æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨ï¼Œè¯·è°ƒæ•´ç­›é€‰æ¡ä»¶")
    
    def render_institutional_data(self):
        """æ¸²æŸ“æœºæ„æ•°æ®"""
        st.header("ğŸ¢ æœºæ„æ•°æ®")
        
        if UNIFIED_DATA_MODULE_AVAILABLE:
            st.success("âœ… æœºæ„æ•°æ®æ¨¡å—å·²è¿æ¥")
            
            # æ•°æ®æºçŠ¶æ€
            try:
                status = get_engine_status()
                st.subheader("ğŸ“Š æ•°æ®æºçŠ¶æ€")
                col1, col2, col3 = st.columns(3)
                with col1:
                    st.metric("æ•°æ®æº", "Tushare Pro")
                with col2:
                    st.metric("è¿æ¥çŠ¶æ€", "æ­£å¸¸")
                with col3:
                    st.metric("æ•°æ®æ›´æ–°", "å®æ—¶")
            except:
                st.warning("âš ï¸ æ— æ³•è·å–æ•°æ®æºçŠ¶æ€")
            
            # æœºæ„æŒä»“æ•°æ®
            st.subheader("ğŸ¦ æœºæ„æŒä»“TOP10")
            institutional_data = {
                'è‚¡ç¥¨ä»£ç ': ['600519', '000858', '600036', '000001', '600887'],
                'è‚¡ç¥¨åç§°': ['è´µå·èŒ…å°', 'äº”ç²®æ¶²', 'æ‹›å•†é“¶è¡Œ', 'å¹³å®‰é“¶è¡Œ', 'ä¼Šåˆ©è‚¡ä»½'],
                'æœºæ„æŒä»“æ¯”ä¾‹': ['68.5%', '45.2%', '52.1%', '38.9%', '41.7%'],
                'åŸºé‡‘æŒä»“æ•°': [1250, 890, 1100, 750, 680],
                'æŒä»“å˜åŒ–': ['+2.1%', '+1.5%', '-0.8%', '+3.2%', '+0.9%']
            }
            
            st.dataframe(pd.DataFrame(institutional_data), use_container_width=True)
            
            # èµ„é‡‘æµå‘
            st.subheader("ğŸ’° èµ„é‡‘æµå‘")
            flow_data = {
                'ç±»å‹': ['ä¸»åŠ›å‡€æµå…¥', 'è¶…å¤§å•å‡€æµå…¥', 'å¤§å•å‡€æµå…¥', 'ä¸­å•å‡€æµå…¥', 'å°å•å‡€æµå…¥'],
                'é‡‘é¢(äº¿å…ƒ)': [15.6, 8.9, 6.7, -3.2, -12.4],
                'å æ¯”': ['12.5%', '7.1%', '5.4%', '-2.6%', '-9.9%']
            }
            
            flow_df = pd.DataFrame(flow_data)
            st.dataframe(flow_df, use_container_width=True)
            
        else:
            st.warning("âš ï¸ æœºæ„æ•°æ®æ¨¡å—æœªè¿æ¥")
            st.info("ğŸ’¡ è¯·ç¡®ä¿ç»Ÿä¸€æœºæ„æ•°æ®æ¨¡å—å·²æ­£ç¡®å®‰è£…å’Œé…ç½®")
            
            # æ¼”ç¤ºæ•°æ®
            st.subheader("ğŸ“Š æ¼”ç¤ºæ•°æ®")
            demo_institutional = {
                'åŠŸèƒ½': ['æœºæ„æŒä»“åˆ†æ', 'èµ„é‡‘æµå‘ç›‘æ§', 'ä¸»åŠ›åŠ¨å‘è¿½è¸ª', 'åŒ—å‘èµ„é‡‘æµå…¥', 'èèµ„èåˆ¸æ•°æ®'],
                'çŠ¶æ€': ['å¾…è¿æ¥', 'å¾…è¿æ¥', 'å¾…è¿æ¥', 'å¾…è¿æ¥', 'å¾…è¿æ¥'],
                'è¯´æ˜': ['éœ€è¦æœºæ„æ•°æ®æ¨¡å—', 'éœ€è¦æœºæ„æ•°æ®æ¨¡å—', 'éœ€è¦æœºæ„æ•°æ®æ¨¡å—', 'éœ€è¦æœºæ„æ•°æ®æ¨¡å—', 'éœ€è¦æœºæ„æ•°æ®æ¨¡å—']
            }
            
            st.dataframe(pd.DataFrame(demo_institutional), use_container_width=True)
    
    def render_ai_prediction(self):
        """æ¸²æŸ“AIé¢„æµ‹"""
        st.header("ğŸ§  AIé¢„æµ‹")
        
        # AIæ¨¡å‹çŠ¶æ€
        st.subheader("ğŸ¤– AIæ¨¡å‹çŠ¶æ€")
        col1, col2, col3 = st.columns(3)
        with col1:
            st.metric("æ¨¡å‹ç‰ˆæœ¬", "V2.1")
        with col2:
            st.metric("è®­ç»ƒæ•°æ®", "5å¹´å†å²")
        with col3:
            st.metric("é¢„æµ‹å‡†ç¡®ç‡", "78.5%")
        
        # è‚¡ç¥¨é€‰æ‹©
        stock_code = st.selectbox("é€‰æ‹©é¢„æµ‹è‚¡ç¥¨", ['000001', '000002', '000858', '600036', '600519'])
        prediction_days = st.slider("é¢„æµ‹å¤©æ•°", 1, 30, 7)
        
        if st.button("ğŸš€ å¼€å§‹é¢„æµ‹"):
            # ç”Ÿæˆé¢„æµ‹æ•°æ®
            current_price = 12.45
            dates = pd.date_range(start=datetime.now(), periods=prediction_days, freq='D')
            
            # æ¨¡æ‹Ÿé¢„æµ‹ç»“æœ
            predicted_prices = []
            price = current_price
            for _ in range(prediction_days):
                change = np.random.normal(0, 0.02)  # 2%çš„æ—¥æ³¢åŠ¨
                price = price * (1 + change)
                predicted_prices.append(price)
            
            prediction_data = pd.DataFrame({
                'æ—¥æœŸ': dates,
                'é¢„æµ‹ä»·æ ¼': predicted_prices,
                'ç½®ä¿¡åŒºé—´ä¸Šé™': [p * 1.05 for p in predicted_prices],
                'ç½®ä¿¡åŒºé—´ä¸‹é™': [p * 0.95 for p in predicted_prices]
            })
            
            # é¢„æµ‹ç»“æœ
            st.subheader("ğŸ“ˆ é¢„æµ‹ç»“æœ")
            st.line_chart(prediction_data.set_index('æ—¥æœŸ'))
            
            # é¢„æµ‹æ‘˜è¦
            final_price = predicted_prices[-1]
            total_change = (final_price - current_price) / current_price * 100
            
            col1, col2, col3 = st.columns(3)
            with col1:
                st.metric("å½“å‰ä»·æ ¼", f"{current_price:.2f}å…ƒ")
            with col2:
                st.metric("é¢„æµ‹ä»·æ ¼", f"{final_price:.2f}å…ƒ")
            with col3:
                st.metric("é¢„æœŸæ¶¨è·Œ", f"{total_change:+.2f}%")
            
            # AIåˆ†æ
            st.subheader("ğŸ¤– AIåˆ†æ")
            if total_change > 5:
                st.success("ğŸŸ¢ AIé¢„æµ‹è¯¥è‚¡ç¥¨æœ‰è¾ƒå¤§ä¸Šæ¶¨ç©ºé—´ï¼Œå»ºè®®å…³æ³¨")
            elif total_change < -5:
                st.error("ğŸ”´ AIé¢„æµ‹è¯¥è‚¡ç¥¨æœ‰ä¸‹è·Œé£é™©ï¼Œå»ºè®®è°¨æ…")
            else:
                st.info("ğŸŸ¡ AIé¢„æµ‹è¯¥è‚¡ç¥¨å°†éœ‡è¡æ•´ç†ï¼Œå»ºè®®è§‚æœ›")
    
    def render_system_settings(self):
        """æ¸²æŸ“ç³»ç»Ÿè®¾ç½®"""
        st.header("âš™ï¸ ç³»ç»Ÿè®¾ç½®")
        
        # ç³»ç»Ÿä¿¡æ¯
        st.subheader("ğŸ“‹ ç³»ç»Ÿä¿¡æ¯")
        info_data = {
            'é¡¹ç›®': ['ç³»ç»Ÿåç§°', 'ç‰ˆæœ¬å·', 'æ¶æ„', 'æ¨¡å—æ•°é‡', 'æ•°æ®æº', 'ç¼“å­˜ç³»ç»Ÿ'],
            'å€¼': [
                self.system_name,
                self.version,
                self.base_architecture,
                '13ä¸ªæ ¸å¿ƒæ¨¡å—',
                'æœºæ„æ•°æ®æ¨¡å—' if UNIFIED_DATA_MODULE_AVAILABLE else 'æ¼”ç¤ºæ•°æ®',
                'æ™ºèƒ½ç¼“å­˜' if self.cache_enabled else 'åŸºç¡€ç¼“å­˜'
            ]
        }
        
        st.dataframe(pd.DataFrame(info_data), use_container_width=True)
        
        # æ€§èƒ½è®¾ç½®
        st.subheader("âš¡ æ€§èƒ½è®¾ç½®")
        col1, col2 = st.columns(2)
        with col1:
            cache_size = st.slider("ç¼“å­˜å¤§å°(MB)", 100, 1000, 512)
            auto_refresh = st.checkbox("è‡ªåŠ¨åˆ·æ–°æ•°æ®", True)
        with col2:
            max_stocks = st.slider("æœ€å¤§è‚¡ç¥¨æ•°é‡", 1000, 10000, 5000)
            enable_logging = st.checkbox("å¯ç”¨æ—¥å¿—è®°å½•", True)
        
        # æ•°æ®æºè®¾ç½®
        st.subheader("ğŸ“Š æ•°æ®æºè®¾ç½®")
        data_source = st.selectbox("ä¸»æ•°æ®æº", ["æœºæ„æ•°æ®æ¨¡å—", "Tushare Pro", "æ¼”ç¤ºæ•°æ®"])
        
        if data_source == "Tushare Pro":
            tushare_token = st.text_input("Tushare Token", type="password")
            if st.button("æµ‹è¯•è¿æ¥"):
                if tushare_token:
                    st.success("âœ… Tushareè¿æ¥æµ‹è¯•æˆåŠŸ")
                else:
                    st.error("âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„Tushare Token")
        
        # ç¼“å­˜ç®¡ç†
        st.subheader("ğŸ—„ï¸ ç¼“å­˜ç®¡ç†")
        col1, col2, col3 = st.columns(3)
        with col1:
            if st.button("æ¸…ç†ç¼“å­˜"):
                if self.cache_system:
                    try:
                        clear_data_cache()
                        st.success("âœ… ç¼“å­˜æ¸…ç†æˆåŠŸ")
                    except:
                        st.warning("âš ï¸ ç¼“å­˜æ¸…ç†å¤±è´¥")
                else:
                    st.info("ğŸ’¡ åŸºç¡€ç¼“å­˜æ¨¡å¼ï¼Œæ— éœ€æ¸…ç†")
        
        with col2:
            if st.button("é‡å¯ç³»ç»Ÿ"):
                st.info("ğŸ”„ ç³»ç»Ÿé‡å¯åŠŸèƒ½å¼€å‘ä¸­...")
        
        with col3:
            if st.button("å¯¼å‡ºè®¾ç½®"):
                settings = {
                    'cache_size': cache_size,
                    'max_stocks': max_stocks,
                    'data_source': data_source,
                    'auto_refresh': auto_refresh,
                    'enable_logging': enable_logging
                }
                st.download_button(
                    "ä¸‹è½½è®¾ç½®æ–‡ä»¶",
                    json.dumps(settings, indent=2),
                    "v001_settings.json",
                    "application/json"
                )
    
    def run(self):
        """è¿è¡Œç³»ç»Ÿ"""
        # é¡µé¢é…ç½®
        st.set_page_config(
            page_title=self.system_name,
            page_icon="ğŸš€",
            layout="wide",
            initial_sidebar_state="expanded"
        )
        
        # è‡ªå®šä¹‰CSS
        st.markdown("""
        <style>
        .main-header {
            background: linear-gradient(90deg, #1e3c72 0%, #2a5298 100%);
            padding: 1rem;
            border-radius: 10px;
            color: white;
            text-align: center;
            margin-bottom: 2rem;
        }
        .module-container {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
        }
        .metric-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        </style>
        """, unsafe_allow_html=True)
        
        # ä¸»æ ‡é¢˜
        st.markdown(f"""
        <div class="main-header">
            <h1>ğŸš€ {self.system_name}</h1>
            <p>ç‰ˆæœ¬: {self.version} | æ¶æ„: {self.base_architecture}</p>
        </div>
        """, unsafe_allow_html=True)
        
        # ä¾§è¾¹æ 
        with st.sidebar:
            st.image("https://via.placeholder.com/200x100/1e3c72/white?text=V001", width=200)
            st.markdown("---")
            
            # æ¨¡å—é€‰æ‹©
            selected_module = st.selectbox(
                "é€‰æ‹©åŠŸèƒ½æ¨¡å—",
                list(self.modules.keys()),
                index=0
            )
            
            st.markdown("---")
            
            # ç³»ç»ŸçŠ¶æ€
            st.subheader("ğŸ“Š ç³»ç»ŸçŠ¶æ€")
            st.text(f"ç‰ˆæœ¬: {self.version}")
            st.text(f"æ¶æ„: v068 + v730")
            st.text(f"æ¨¡å—: 13ä¸ªæ ¸å¿ƒæ¨¡å—")
            st.text(f"æ›´æ–°: {datetime.now().strftime('%H:%M:%S')}")
        
        # æ¸²æŸ“é€‰ä¸­çš„æ¨¡å—
        if selected_module in self.modules:
            self.modules[selected_module]()
        
        # é¡µè„šä¿¡æ¯
        st.markdown("---")
        st.markdown(f"<p style='text-align: center; color: #666; font-size: 0.9rem;'>Â© 2025 {self.system_name} | ç‰ˆæœ¬: {self.version} | æ›´æ–°æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}</p>", unsafe_allow_html=True)

def main():
    """ä¸»å‡½æ•°"""
    system = V001CompleteSystem()
    system.run()

if __name__ == "__main__":
    main()
